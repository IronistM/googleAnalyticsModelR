googleAnalyticsModelR
=====================

Creating ready made models to work with `googleAnalyticsR` data

Setup
-----

    install.packages(c("remotes","googleAnalyticsR"))
    remotes::install_github("IronistM/googleAnalyticsModelR")

Useage
------

For end users, they can just load the model then apply it to their data:

    library(googleAnalyticsR)  # assume auto-authentication
    library(googleAnalyticsModelR)

    # fetches data and outputs decomposition
    my_viewid <- 81416156
    decomp_ga <- "inst/models/decomp_ga.gamr"
    ga_model(my_viewid, model = decomp_ga)

![](README_files/figure-markdown_strict/unnamed-chunk-1-1.png)

    ## $decom
    ## $x
    ## Time Series:
    ## Start = c(1, 1) 
    ## End = c(43, 7) 
    ## Frequency = 7 
    ##   [1] 308 319 288 253 119  93 271 280 283 259 247  87 101 219 201 274 417
    ##  [18] 281 113 120 283 348 343 296 235 143 112 305 355 299 326 280 124 149
    ##  [35] 276 248 386 333 270 152 143 294 276 300 329 285 115 125 284 351 296
    ##  [52] 266 289 154 118 353 368 369 311 271 105 106 284 307 329 333 268 104
    ##  [69] 130 334 312 313 315 309 143 127 303 334 300 293 303 107 112 275 289
    ##  [86] 332 318 283 126  72 298 332 365 302 318 127 132 320 360 318 260 234
    ## [103] 110 125 317 371 372 333 230  97 101 315 319 320 329 216 117 104 292
    ## [120] 251 261 525 411 163 164 438 350 296 282 297 115  93 293 299 330 310
    ## [137] 272 131  99 281 309 314 286 284 117  75 295 320 306 347 316  99 149
    ## [154] 346 364 335 301 267 118 118 284 339 319 342 244 136 125 337 301 323
    ## [171] 312 317 115 105 266 313 347 325 256 149 145 285 334 298 326 291 104
    ## [188]  91 281 299 363 311 242 109 136 312 377 298 284 248 112 124 307 333
    ## [205] 299 279 402 219 170 336 395 311 301 268 163 147 286 349 294 279 236
    ## [222] 130 131 324 316 377 329 448 292 171 406 364 280 348 318 125 120 338
    ## [239] 337 296 291 317 145 144 305 287 265 267 281 135  88 122  74 124 141
    ## [256] 188  68  72 109  60 214 245 270 107  90 281 303 316 234 250 117  89
    ## [273] 239 315 238 261 235  91  86 232 296 360 317 261 110 100 299 323 329
    ## [290] 257 271 120 131 309 335 290 323 302 142 134 138
    ## 
    ## $seasonal
    ## Time Series:
    ## Start = c(1, 1) 
    ## End = c(43, 7) 
    ## Frequency = 7 
    ##   [1]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ##   [7]   44.71968   60.26729   59.90335   56.45437   31.98126 -121.95039
    ##  [13] -131.37556   44.71968   60.26729   59.90335   56.45437   31.98126
    ##  [19] -121.95039 -131.37556   44.71968   60.26729   59.90335   56.45437
    ##  [25]   31.98126 -121.95039 -131.37556   44.71968   60.26729   59.90335
    ##  [31]   56.45437   31.98126 -121.95039 -131.37556   44.71968   60.26729
    ##  [37]   59.90335   56.45437   31.98126 -121.95039 -131.37556   44.71968
    ##  [43]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ##  [49]   44.71968   60.26729   59.90335   56.45437   31.98126 -121.95039
    ##  [55] -131.37556   44.71968   60.26729   59.90335   56.45437   31.98126
    ##  [61] -121.95039 -131.37556   44.71968   60.26729   59.90335   56.45437
    ##  [67]   31.98126 -121.95039 -131.37556   44.71968   60.26729   59.90335
    ##  [73]   56.45437   31.98126 -121.95039 -131.37556   44.71968   60.26729
    ##  [79]   59.90335   56.45437   31.98126 -121.95039 -131.37556   44.71968
    ##  [85]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ##  [91]   44.71968   60.26729   59.90335   56.45437   31.98126 -121.95039
    ##  [97] -131.37556   44.71968   60.26729   59.90335   56.45437   31.98126
    ## [103] -121.95039 -131.37556   44.71968   60.26729   59.90335   56.45437
    ## [109]   31.98126 -121.95039 -131.37556   44.71968   60.26729   59.90335
    ## [115]   56.45437   31.98126 -121.95039 -131.37556   44.71968   60.26729
    ## [121]   59.90335   56.45437   31.98126 -121.95039 -131.37556   44.71968
    ## [127]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ## [133]   44.71968   60.26729   59.90335   56.45437   31.98126 -121.95039
    ## [139] -131.37556   44.71968   60.26729   59.90335   56.45437   31.98126
    ## [145] -121.95039 -131.37556   44.71968   60.26729   59.90335   56.45437
    ## [151]   31.98126 -121.95039 -131.37556   44.71968   60.26729   59.90335
    ## [157]   56.45437   31.98126 -121.95039 -131.37556   44.71968   60.26729
    ## [163]   59.90335   56.45437   31.98126 -121.95039 -131.37556   44.71968
    ## [169]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ## [175]   44.71968   60.26729   59.90335   56.45437   31.98126 -121.95039
    ## [181] -131.37556   44.71968   60.26729   59.90335   56.45437   31.98126
    ## [187] -121.95039 -131.37556   44.71968   60.26729   59.90335   56.45437
    ## [193]   31.98126 -121.95039 -131.37556   44.71968   60.26729   59.90335
    ## [199]   56.45437   31.98126 -121.95039 -131.37556   44.71968   60.26729
    ## [205]   59.90335   56.45437   31.98126 -121.95039 -131.37556   44.71968
    ## [211]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ## [217]   44.71968   60.26729   59.90335   56.45437   31.98126 -121.95039
    ## [223] -131.37556   44.71968   60.26729   59.90335   56.45437   31.98126
    ## [229] -121.95039 -131.37556   44.71968   60.26729   59.90335   56.45437
    ## [235]   31.98126 -121.95039 -131.37556   44.71968   60.26729   59.90335
    ## [241]   56.45437   31.98126 -121.95039 -131.37556   44.71968   60.26729
    ## [247]   59.90335   56.45437   31.98126 -121.95039 -131.37556   44.71968
    ## [253]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ## [259]   44.71968   60.26729   59.90335   56.45437   31.98126 -121.95039
    ## [265] -131.37556   44.71968   60.26729   59.90335   56.45437   31.98126
    ## [271] -121.95039 -131.37556   44.71968   60.26729   59.90335   56.45437
    ## [277]   31.98126 -121.95039 -131.37556   44.71968   60.26729   59.90335
    ## [283]   56.45437   31.98126 -121.95039 -131.37556   44.71968   60.26729
    ## [289]   59.90335   56.45437   31.98126 -121.95039 -131.37556   44.71968
    ## [295]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ## [301]   44.71968
    ## 
    ## $trend
    ## Time Series:
    ## Start = c(1, 1) 
    ## End = c(43, 7) 
    ## Frequency = 7 
    ##   [1]       NA       NA       NA 235.8571 231.8571 226.7143 222.5714
    ##   [8] 221.7143 217.1429 218.2857 210.8571 199.5714 198.2857 220.8571
    ##  [15] 225.7143 229.4286 232.1429 241.2857 262.2857 272.1429 254.8571
    ##  [22] 248.2857 252.5714 251.4286 254.5714 255.5714 249.2857 253.5714
    ##  [29] 260.0000 257.2857 262.5714 258.4286 243.1429 255.5714 256.5714
    ##  [36] 255.1429 259.1429 258.2857 260.8571 264.8571 252.5714 252.0000
    ##  [43] 254.1429 248.8571 246.2857 244.8571 255.5714 255.0000 246.0000
    ##  [50] 246.5714 252.1429 251.1429 261.0000 263.4286 273.8571 280.2857
    ##  [57] 277.7143 270.7143 269.0000 259.1429 250.4286 244.7143 247.8571
    ##  [64] 247.4286 247.2857 250.7143 257.8571 258.5714 256.2857 253.7143
    ##  [71] 259.5714 265.1429 264.7143 260.2857 263.4286 261.5714 258.4286
    ##  [78] 257.5714 252.4286 250.2857 246.2857 239.8571 244.4286 248.0000
    ##  [85] 245.1429 247.8571 242.1429 245.4286 251.5714 256.2857 254.0000
    ##  [92] 259.0000 259.1429 267.7143 270.8571 274.8571 268.1429 262.1429
    ##  [99] 250.1429 247.7143 246.7143 246.2857 247.8571 255.5714 266.0000
    ## [106] 265.4286 263.5714 260.1429 259.8571 252.4286 245.0000 244.4286
    ## [113] 242.4286 245.2857 245.7143 242.4286 232.7143 224.2857 252.2857
    ## [120] 280.1429 286.7143 295.2857 316.1429 330.2857 335.2857 300.5714
    ## [127] 284.2857 277.4286 267.2857 246.5714 239.2857 244.1429 248.1429
    ## [134] 244.5714 246.8571 247.7143 246.0000 247.4286 245.1429 241.7143
    ## [141] 243.4286 241.4286 238.0000 240.0000 241.5714 240.4286 249.1429
    ## [148] 253.7143 251.1429 261.7143 269.0000 275.2857 279.4286 272.8571
    ## [155] 265.8571 268.5714 264.1429 255.2857 251.7143 249.4286 255.2857
    ## [162] 252.0000 254.5714 255.5714 263.1429 257.7143 258.2857 254.0000
    ## [169] 264.4286 261.4286 258.5714 248.4286 250.1429 253.5714 255.4286
    ## [176] 246.7143 251.5714 257.2857 260.0000 263.0000 256.0000 256.1429
    ## [183] 261.1429 254.7143 247.0000 246.4286 241.4286 250.7143 248.5714
    ## [190] 241.5714 242.2857 248.7143 253.1429 264.2857 255.0000 251.1429
    ## [197] 252.0000 252.4286 250.7143 250.0000 243.7143 243.8571 243.1429
    ## [204] 265.1429 280.4286 287.0000 291.1429 300.0000 301.7143 304.8571
    ## [211] 285.7143 277.7143 274.4286 267.2857 260.7143 258.2857 255.1429
    ## [218] 250.5714 245.8571 243.5714 249.0000 244.2857 256.1429 263.2857
    ## [225] 293.5714 316.7143 322.4286 334.1429 341.0000 327.1429 329.8571
    ## [232] 311.2857 287.4286 280.1429 270.4286 266.5714 268.8571 260.7143
    ## [239] 260.5714 263.4286 266.8571 262.1429 255.0000 250.5714 247.1429
    ## [246] 242.0000 240.5714 232.5714 206.4286 176.0000 155.8571 137.8571
    ## [253] 124.5714 115.0000 112.7143 110.8571 108.8571 121.7143 136.5714
    ## [260] 148.2857 153.8571 156.4286 181.0000 215.7143 230.2857 228.7143
    ## [267] 225.8571 227.2857 227.1429 221.1429 222.8571 211.7143 215.5714
    ## [274] 213.4286 209.7143 209.2857 208.2857 205.5714 223.0000 231.0000
    ## [281] 234.7143 237.4286 239.4286 249.0000 252.8571 248.4286 239.8571
    ## [288] 241.2857 242.7143 247.1429 248.5714 250.2857 244.7143 254.1429
    ## [295] 258.5714 261.7143 262.1429 237.7143       NA       NA       NA
    ## 
    ## $random
    ## Time Series:
    ## Start = c(1, 1) 
    ## End = c(43, 7) 
    ## Frequency = 7 
    ##   [1]            NA            NA            NA  -14.83840712    9.09324926
    ##   [6]   -2.33872353    3.70889552   -1.98158067    5.95379348  -15.74008407
    ##  [11]    4.16159288    9.37896355   34.08984790  -46.57681877  -84.98158067
    ##  [16]  -15.33192081  128.40277307    7.73302145  -27.33532217  -20.76729496
    ##  [21]  -16.57681877   39.44699076   30.52522205  -11.88294122  -51.55269284
    ##  [26]    9.37896355   -5.91015210    6.70889552   34.73270504  -18.18906367
    ##  [31]    6.97420164  -10.40983570    2.80753497   24.80413361  -25.29110448
    ##  [36]  -67.41015210   66.95379348   18.25991593  -22.83840712    9.09324926
    ##  [41]   21.80413361   -2.71967591  -38.41015210   -8.76049224   26.25991593
    ##  [46]    8.16159288  -18.62103645    1.37556219   -6.71967591   44.16127647
    ##  [51]  -16.04620652  -41.59722693   -3.98126427   12.52182069  -24.48158067
    ##  [56]   27.99460980   30.01841933   38.38236491  -14.45436979  -20.12412141
    ##  [61]  -23.47817931   -7.33872353   -8.57681877   -0.69586639   21.81093633
    ##  [66]   25.83134450  -21.83840712  -32.62103645    5.08984790   35.56603838
    ##  [71]   -7.83872353  -12.04620652   -6.16865550   16.73302145    1.52182069
    ##  [76]   -3.19586639   -0.14824734   16.16127647  -12.33192081  -13.74008407
    ##  [81]   24.73302145  -10.90675074   -1.05300924  -17.71967591  -16.41015210
    ##  [86]   24.23950776   19.40277307    5.59016430   -3.62103645  -52.91015210
    ##  [91]   -0.71967591   12.73270504   45.95379348  -22.16865550   15.16159288
    ##  [96]  -25.90675074   -4.76729496   13.13746695   49.58984790   10.38236491
    ## [101]  -43.16865550  -44.26697855  -15.90675074    0.80413361    6.28032409
    ## [106]   45.30413361   48.52522205   16.40277307  -61.83840712  -33.47817931
    ## [111]  -12.62443781   25.85175266   16.30413361   14.81093633   26.83134450
    ## [116]  -58.40983570    6.23610640   11.08984790   -5.00539020  -89.41015210
    ## [121]  -85.61763509  173.25991593   62.87587859  -45.33532217  -39.91015210
    ## [126]   92.70889552    5.44699076  -41.33192081  -41.74008407   18.44730716
    ## [131]   -2.33532217  -19.76729496    0.13746695   -5.83872353   23.23950776
    ## [136]    5.83134450   -5.98126427    5.52182069  -14.76729496   -5.43396162
    ## [141]    5.30413361   12.66807919   -8.45436979   12.01873573   -2.62103645
    ## [146]  -34.05300924    1.13746695    6.01841933   -5.04620652   28.83134450
    ## [151]   15.01873573  -54.33532217    0.94699076   28.42318123   37.87556219
    ## [156]    6.52522205  -19.59722693  -20.26697855  -11.76389360   -0.05300924
    ## [161]  -16.00539020   26.73270504    4.52522205   29.97420164  -51.12412141
    ## [166]    0.23610640   -1.91015210   38.28032409  -23.69586639    1.66807919
    ## [171]   -3.02579836   36.59016430  -13.19246503  -17.19586639  -34.14824734
    ## [176]    6.01841933   35.52522205   11.25991593  -35.98126427    7.95039212
    ## [181]   20.37556219  -15.86253305   12.58984790  -16.61763509   22.54563021
    ## [186]   12.59016430  -15.47817931  -28.33872353  -12.29110448   -2.83872353
    ## [191]   60.81093633    5.83134450  -43.12412141  -33.33532217   12.37556219
    ## [196]   16.13746695   64.73270504  -14.33192081  -23.16865550  -33.98126427
    ## [201]   -9.76389360   11.51841933   19.13746695    7.58984790  -41.33192081
    ## [206]  -64.45436979   78.87587859   40.95039212   -0.33872353  -13.57681877
    ## [211]   49.01841933  -26.61763509  -29.88294122  -31.26697855   24.23610640
    ## [216]   20.08984790  -13.86253305   38.16127647  -11.76049224  -21.02579836
    ## [221]  -44.98126427    7.66467783    6.23270504   15.99460980  -37.83872353
    ## [226]    0.38236491  -49.88294122   81.87587859   72.95039212  -24.76729496
    ## [231]   31.42318123   -7.55300924  -67.33192081   11.40277307   15.59016430
    ## [236]  -19.62103645  -17.48158067   32.56603838   16.16127647  -27.33192081
    ## [241]  -32.31151264   22.87587859   11.95039212   24.80413361   13.13746695
    ## [246]  -15.26729496  -35.47477795  -22.02579836   42.59016430   80.95039212
    ## [251]   63.51841933  -60.57681877 -110.83872353  -50.90334938  -28.16865550
    ## [256]   45.16159288   81.09324926   81.66127647  -72.29110448 -148.55300924
    ## [261]    0.23950776   32.11705878   57.01873573   13.23610640   -8.91015210
    ## [266]    7.56603838   16.87556219   28.81093633  -49.59722693   -3.12412141
    ## [271]   16.09324926    8.66127647  -21.29110448   41.30413361  -31.61763509
    ## [276]   -4.74008407   -5.26697855    7.37896355   -5.62443781  -43.71967591
    ## [281]    1.01841933   62.66807919   21.11705878  -19.98126427  -20.90675074
    ## [286]  -17.05300924   14.42318123   21.44699076   26.38236491  -46.59722693
    ## [291]   -9.55269284   -8.33532217   17.66127647   10.13746695   16.16127647
    ## [296]  -31.61763509    4.40277307   32.30445002            NA            NA
    ## [301]            NA
    ## 
    ## $figure
    ## [1]   60.26729   59.90335   56.45437   31.98126 -121.95039 -131.37556
    ## [7]   44.71968
    ## 
    ## $type
    ## [1] "additive"
    ## 
    ## attr(,"class")
    ## [1] "decomposed.ts"
    ## 
    ## $plot
    ## NULL

    #repeat with another viewId
    ga_model(123875646, model = decomp_ga)

![](README_files/figure-markdown_strict/unnamed-chunk-1-2.png)

    ## $decom
    ## $x
    ## Time Series:
    ## Start = c(1, 1) 
    ## End = c(43, 7) 
    ## Frequency = 7 
    ##   [1] 16 20 12 12  3  4 10 17  9 13  7  4  5 11 11 10 11  3  8  6  8 16 64
    ##  [24] 26 20  5  3 13 22 17 17 18  7  6  7 14  7 11  9  7  1  4 15 10  9 13
    ##  [47]  1  3  6 19 19 10 14  4  2 16  7 10 15 10  2  2 12 13 11 14  8  8  7
    ##  [70] 14 15 14  7  5  8 16 14 16  8  7 12  3  3 16 14 14  8 19  5  4  5 14
    ##  [93] 12 12 16  8  3 13 13  6 10  8  5  3 10 23 38 16 20  7  5 21 18 16 11
    ## [116]  8  2  4 10 16 16  9  9  4  3  9 14 12  6  4  7  3 14 15 10  7 19  4
    ## [139]  6  7 16 12 17 10  5  3  7 15 10  9  9  6  4 12  8  5 13  9  2  2 15
    ## [162] 10  9 16 13  2  8  7  8 11  5 12  2  7 14 10  9  6 12  7 23 17 14  5
    ## [185] 17 11  7  5 10 13  9 14 15  7  8 11  9  3  8 24 28 10 14 10 12 29 38
    ## [208] 29 12 30 22 17 12 17  6  8 10 15 11  9  5  3  9 10  9 15 11  9  4  4
    ## [231] 13 23 11 11 16  8  7  8 12 11 20 13  7  2 22 14 17 11  4  7  6  5  1
    ## [254]  4 15  8  7  6  4  6 13 20 14  5  3 14 13 22 11 17  8  3  8 12 11 16
    ## [277] 13  7  6 17 23 15 15  9  4  0  7 15 15 14 19  8  8 30 21 12 14 10  6
    ## [300]  9 16
    ## 
    ## $seasonal
    ## Time Series:
    ## Start = c(1, 1) 
    ## End = c(43, 7) 
    ## Frequency = 7 
    ##   [1]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##   [8]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [15]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [22]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [29]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [36]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [43]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [50]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [57]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [64]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [71]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [78]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [85]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [92]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ##  [99]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [106]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [113]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [120]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [127]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [134]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [141]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [148]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [155]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [162]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [169]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [176]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [183]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [190]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [197]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [204]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [211]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [218]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [225]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [232]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [239]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [246]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [253]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [260]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [267]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [274]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [281]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [288]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## [295]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## 
    ## $trend
    ## Time Series:
    ## Start = c(1, 1) 
    ## End = c(43, 7) 
    ## Frequency = 7 
    ##   [1]        NA        NA        NA 11.000000 11.142857  9.571429  9.714286
    ##   [8]  9.000000  9.142857  9.285714  9.428571  8.571429  8.714286  8.428571
    ##  [15]  7.857143  8.428571  8.571429  8.142857  8.857143 16.571429 18.714286
    ##  [22] 21.142857 20.714286 20.285714 21.000000 21.857143 15.142857 13.857143
    ##  [29] 13.571429 13.857143 14.285714 13.428571 12.285714 10.857143 10.000000
    ##  [36]  8.714286  8.714286  8.000000  7.571429  7.714286  8.142857  7.857143
    ##  [43]  8.428571  7.571429  7.857143  8.142857  8.714286 10.000000 10.142857
    ##  [50] 10.285714 10.714286 10.571429 12.000000 10.285714  9.000000  9.714286
    ##  [57]  9.142857  8.857143  8.857143  8.285714  9.142857  9.285714  9.142857
    ##  [64]  8.857143  9.714286 10.428571 10.714286 11.000000 11.428571 10.428571
    ##  [71] 10.000000 10.000000 11.285714 11.285714 11.428571 10.571429 10.571429
    ##  [78] 11.571429 10.857143  9.000000  9.285714  9.000000  9.857143 10.000000
    ##  [85] 11.000000 11.285714 11.428571  9.857143  9.857143  9.571429 10.142857
    ##  [92]  9.714286 10.142857 10.000000 11.142857 11.000000 10.142857  9.857143
    ##  [99]  8.714286  8.285714  8.285714  7.857143  9.285714 13.857143 14.714286
    ## [106] 16.428571 16.714286 17.000000 18.571429 17.857143 14.714286 14.000000
    ## [113] 12.285714 11.571429 11.428571  9.857143  9.571429  9.571429  9.285714
    ## [120]  9.428571  9.714286  9.571429  9.428571  9.142857  8.571429  8.142857
    ## [127]  7.428571  7.857143  7.857143  8.571429  8.714286  8.428571  8.571429
    ## [134] 10.714286 10.285714 10.714286  9.714286  9.857143 10.142857 11.571429
    ## [141] 10.285714 10.428571 10.000000 10.000000  9.857143  9.571429  8.428571
    ## [148]  8.285714  8.428571  8.571429  9.285714  8.285714  7.571429  8.142857
    ## [155]  8.142857  7.571429  7.285714  7.714286  8.000000  8.571429  9.000000
    ## [162]  9.571429  9.571429 10.428571  9.285714  9.000000  9.285714  7.714286
    ## [169]  7.571429  7.571429  7.428571  8.428571  8.714286  8.428571  8.571429
    ## [176]  8.571429  9.285714 11.571429 12.000000 12.571429 12.000000 13.571429
    ## [183] 13.428571 13.428571 10.857143  9.857143  9.714286 10.285714  9.857143
    ## [190] 10.428571 10.428571 10.857143 11.000000 10.428571  9.571429  8.714286
    ## [197] 10.000000 13.000000 13.285714 13.714286 13.857143 15.142857 18.142857
    ## [204] 20.142857 20.285714 20.571429 22.857143 24.571429 25.285714 22.857143
    ## [211] 19.857143 16.571429 16.000000 13.142857 12.142857 11.285714 10.857143
    ## [218]  9.142857  8.714286  8.857143  8.857143  8.000000  8.571429  8.857143
    ## [225]  9.428571  9.571429  8.857143  9.285714 11.285714 10.714286 10.714286
    ## [232] 11.714286 12.285714 12.714286 12.000000 10.428571 10.428571 11.714286
    ## [239] 11.285714 11.142857 10.428571 12.428571 12.714286 13.571429 12.285714
    ## [246] 11.000000 11.000000 11.571429  9.142857  7.285714  5.428571  6.000000
    ## [253]  6.571429  6.571429  6.571429  6.428571  7.142857  8.428571  9.142857
    ## [260] 10.000000  9.714286  9.285714 10.714286 11.714286 13.000000 11.714286
    ## [267] 12.142857 12.571429 12.571429 11.714286 11.571429 10.000000 10.714286
    ## [274] 10.142857 10.000000 10.428571 11.714286 13.285714 13.857143 13.714286
    ## [281] 13.142857 12.714286 11.857143 10.428571  9.285714  9.285714  9.142857
    ## [288] 10.571429 11.142857 12.285714 15.571429 16.428571 16.000000 16.000000
    ## [295] 14.714286 14.428571 14.571429 12.571429        NA        NA        NA
    ## 
    ## $random
    ## Time Series:
    ## Start = c(1, 1) 
    ## End = c(43, 7) 
    ## Frequency = 7 
    ##   [1]            NA            NA            NA  -0.590379009  -3.624392614
    ##   [6]  -0.175413022  -0.787657920   4.872206025  -2.569970845   2.018464529
    ##  [11]  -4.018950437  -0.052964043   1.681729835   1.498056365   0.015063168
    ##  [16]  -0.855685131   0.732750243  -6.733236152   3.661321672  -5.175413022
    ##  [21] -11.787657920  -8.270651118  40.858600583   4.018464529  -2.590379009
    ##  [26] -12.338678328  -6.746841594  -1.930515063   5.300777454   0.715743440
    ##  [31]   1.018464529   2.981049563  -0.767249757   0.538872692  -4.073372206
    ##  [36]   2.157920311  -4.141399417   1.304178814  -0.161807580   3.804178814
    ##  [41]  -1.746841594  -4.930515063   3.443634597   0.001457726  -0.552964043
    ##  [46]   3.266763848  -3.195821186  -1.603984451  -5.216229349   5.586491740
    ##  [51]   5.858600583  -2.267249757   0.409620991  -1.767249757  -1.603984451
    ##  [56]   5.212342080  -5.270651118  -1.284256560   4.447035957   0.123906706
    ##  [61]  -2.624392614  -1.889698737   1.783770651   1.015063168  -1.141399417
    ##  [66]   1.875607386  -4.304664723   1.518464529   0.967444121   2.498056365
    ##  [71]   1.872206025   1.572886297  -5.981535471  -7.876093294   1.089893100
    ##  [76]  10.824586978   2.355199223   1.300777454  -5.284256560  -3.695821186
    ##  [81]   1.123906706  -1.481535471  -1.461127308   4.926627794  -0.127793975
    ##  [86]   0.287172012  -5.124392614   7.552478134  -0.338678328  -0.175413022
    ##  [91]  -6.216229349   1.157920311  -0.569970845   0.304178814   3.266763848
    ##  [96]   1.518464529  -1.746841594   2.069484937   1.157920311  -4.712827988
    ## [101]   0.018464529  -1.447521866   0.232750243  -5.461127308  -5.787657920
    ## [106]   3.443634597  18.858600583  -2.695821186  -0.161807580  -6.338678328
    ## [111]  -4.318270165   5.926627794   2.586491740   2.001457726  -2.124392614
    ## [116]  -3.447521866  -3.052964043  -0.175413022  -0.359086492   3.443634597
    ## [121]   3.858600583  -2.267249757  -2.018950437  -0.624392614  -0.175413022
    ## [126]  -0.216229349   3.443634597   1.715743440  -3.552964043  -6.161807580
    ## [131]   2.804178814  -0.032555879   4.355199223   1.157920311  -2.712827988
    ## [136]  -5.410106900   7.695335277  -1.338678328   1.253158406  -5.644800777
    ## [141]   2.586491740  -0.855685131   5.304178814  -1.590379009  -0.338678328
    ## [146]  -1.175413022  -2.501943635   3.586491740  -0.855685131  -1.267249757
    ## [151]  -1.876093294   2.232750243   1.824586978   2.783770651  -3.270651118
    ## [156]  -4.998542274   4.018464529  -0.304664723  -1.481535471  -1.175413022
    ## [161]   4.926627794  -2.699222546  -2.998542274   3.875607386   2.123906706
    ## [166]  -2.481535471   4.110301263  -1.787657920  -2.699222546   1.001457726
    ## [171]  -4.124392614   1.981049563  -2.195821186   3.967444121   4.355199223
    ## [176]  -1.699222546  -2.712827988  -7.267249757  -1.590379009  -1.052964043
    ## [181]  16.396015549   2.355199223  -2.556365403 -10.855685131   4.447035957
    ## [186]  -0.447521866   1.804178814   0.110301263  -0.930515063  -0.556365403
    ## [191]  -3.855685131   1.447035957   2.409620991   1.089893100   3.824586978
    ## [196]   1.212342080  -4.127793975 -12.427113703  -6.981535471   8.695335277
    ## [201]  18.661321672   0.253158406  -5.216229349 -13.270651118 -10.712827988
    ## [206]   6.732750243  13.552478134   8.947035957  -7.889698737   6.069484937
    ## [211]  -0.984936832  -1.998542274  -5.695821186   2.266763848  -1.624392614
    ## [216]   2.110301263  -1.930515063   2.729348882  -0.141399417  -1.552964043
    ## [221]  -5.447521866  -0.481535471   5.824586978   0.069484937  -3.556365403
    ## [226]   3.001457726   0.447035957  -1.876093294  -2.767249757  -1.318270165
    ## [231]   1.212342080   8.157920311  -3.712827988  -3.410106900   2.409620991
    ## [236]   2.089893100   1.967444121  -4.787657920  -2.413508260  -2.569970845
    ## [241]   7.875607386  -1.018950437  -1.195821186  -6.175413022   8.640913508
    ## [246]  -0.127793975   3.572886297  -2.267249757  -6.733236152   4.232750243
    ## [251]   5.967444121  -2.073372206  -8.699222546  -4.998542274   6.732750243
    ## [256]  -0.018950437   4.375607386   2.967444121  -6.216229349  -7.127793975
    ## [261]   0.858600583   9.018464529   1.695335277  -2.195821186  -4.603984451
    ## [266]   1.212342080  -2.270651118   7.001457726  -3.267249757   3.695335277
    ## [271]   0.947035957  -1.603984451  -3.787657920  -1.270651118  -1.427113703
    ## [276]   3.875607386  -0.304664723  -1.767249757  -2.461127308   2.212342080
    ## [281]   6.729348882  -0.141399417   1.447035957  -3.018950437  -0.767249757
    ## [286]  -3.889698737  -3.216229349   1.300777454   1.430029155   0.018464529
    ## [291]   1.838192420  -3.910106900  -2.603984451  12.926627794   3.157920311
    ## [296]  -4.855685131  -2.267249757  -4.161807580            NA            NA
    ## [301]            NA
    ## 
    ## $figure
    ## [1]  3.127794  2.427114  1.695821  1.590379 -4.518465 -5.396016  1.073372
    ## 
    ## $type
    ## [1] "additive"
    ## 
    ## attr(,"class")
    ## [1] "decomposed.ts"
    ## 
    ## $plot
    ## NULL

Creating models
---------------

It needs:

-   A function to collect the data you will need. The first argument
    should be `viewId`
-   A function to work with the data you have fetched. The first
    argument should be the data.frame that is produced by the data
    fetching function.
-   Specification of which R libraries the functions need

The functions need to not use the same arguments, and both include `...`
as the dots are shared between them.

    library(googleAnalyticsR) # assume auto-authentication
    library(googleAnalyticsModelR)

    get_model_data <- function(viewId, 
                               date_range = c(Sys.Date()- 300, Sys.Date()), 
                               ...){
      google_analytics(viewId, 
                       date_range = date_range, 
                       metrics = "sessions", 
                       dimensions = "date", 
                       max = -1)
     }

    decompose_sessions <- function(df, ...){
      web_data_ts <- ts(df$sessions, frequency = 7)
      d <- decompose(web_data_ts)
      list(decom = d, plot = plot(d))
    }
     
    decomp_ga <- ga_model_make(get_model_data,
                               required_columns = c("date", "sessions"),
                               model_f = decompose_sessions,
                               description = "Performs decomposition on session data and creates a plot")
     
    # fetches data and outputs decomposition
    ga_model(81416156, decomp_ga)
     
    # save the model for later
    model_location <- "inst/models/decomp_ga.gamr"
    ga_model_save(decomp_ga, filename = model_location)
     
    # can load model from file
    ga_model(81416156, model_location)
     
    # load model and use again
    model2 <- ga_model_load(model_location)
     
    ga_model(81416156, model2)

More complicated example
------------------------

Using `?ga_anomaly_detection`

    library(googleAnalyticsR)
    library(googleAnalyticsModelR)

    get_anom_data <- function(viewId, 
                              date_range = c(Sys.Date()-600, Sys.Date()),
                              ...){
      google_analytics(viewId, date_range = date_range,
                       metrics = c("sessions","users"),
                       dimensions = "date", 
                       max = -1)
    }

    do_anomaly <- function(df, 
                           value_col = "sessions",
                           max_anoms = 0.1,
                           ...){
      ga_check_anomaly(
        df = df,
        time_col = "date",
        value_col = value_col,
        max_anoms = max_anoms
      )
    }

    req_packs <- c("lubridate", "dplyr", "exploratory", "AnomalyDetection")

    anomaly_model <- ga_model_make(get_anom_data,
                                   required_columns = c("date","sessions","users"),
                                   model_f = do_anomaly,
                                   required_packages = req_packs,
                                   description = "Anomaly detection using Twitter algo on users or sessions")
    # print out model details
    anomaly_model

    ## ==ga_model object==
    ## Description:  Anomaly detection using Twitter algo on users or sessions 
    ## Data args:    viewId date_range 
    ## Input data:   date sessions users 
    ## Model args:   df value_col max_anoms 
    ## Packages:     lubridate dplyr exploratory AnomalyDetection

    # save it to a file for use later
    ga_model_save(anomaly_model, "inst/models/anomaly_model.gamr")

To use, we now have more arguments an end user can specify:

    library(googleAnalyticsR)  # assume auto-authentication
    library(googleAnalyticsModelR)

    # install any needed libraries
    #remotes::install_github("twitter/AnomalyDetection")

    my_viewid <- 81416156
    ga_model(my_viewid, 
             model = "inst/models/anomaly_model.gamr",
             date_range = c(Sys.Date()-601, Sys.Date()-1),
             value_col = "users",
             max_anoms = 0.5)

    ## # A tibble: 601 x 7
    ##    date                users is_positive_ano… positive_anomal…
    ##    <dttm>              <dbl> <lgl>                       <dbl>
    ##  1 2017-06-20 00:00:00   206 FALSE                          NA
    ##  2 2017-06-21 00:00:00   193 FALSE                          NA
    ##  3 2017-06-22 00:00:00   184 FALSE                          NA
    ##  4 2017-06-23 00:00:00   184 FALSE                          NA
    ##  5 2017-06-24 00:00:00    88 FALSE                          NA
    ##  6 2017-06-25 00:00:00    91 FALSE                          NA
    ##  7 2017-06-26 00:00:00   177 FALSE                          NA
    ##  8 2017-06-27 00:00:00   178 FALSE                          NA
    ##  9 2017-06-28 00:00:00   193 FALSE                          NA
    ## 10 2017-06-29 00:00:00   183 FALSE                          NA
    ## # … with 591 more rows, and 3 more variables: is_negative_anomaly <lgl>,
    ## #   negative_anomalies <dbl>, expected_value <dbl>

    #repeat with another viewId
    ga_model(123875646, 
             model = "inst/models/anomaly_model.gamr",
             date_range = c(Sys.Date()-601, Sys.Date()-1),
             value_col = "users",
             max_anoms = 0.5)

    ## # A tibble: 601 x 7
    ##    date                users is_positive_ano… positive_anomal…
    ##    <dttm>              <dbl> <lgl>                       <dbl>
    ##  1 2017-06-20 00:00:00    15 FALSE                          NA
    ##  2 2017-06-21 00:00:00     9 FALSE                          NA
    ##  3 2017-06-22 00:00:00    15 FALSE                          NA
    ##  4 2017-06-23 00:00:00    15 FALSE                          NA
    ##  5 2017-06-24 00:00:00     5 FALSE                          NA
    ##  6 2017-06-25 00:00:00     4 FALSE                          NA
    ##  7 2017-06-26 00:00:00    18 FALSE                          NA
    ##  8 2017-06-27 00:00:00    16 FALSE                          NA
    ##  9 2017-06-28 00:00:00     7 FALSE                          NA
    ## 10 2017-06-29 00:00:00     8 FALSE                          NA
    ## # … with 591 more rows, and 3 more variables: is_negative_anomaly <lgl>,
    ## #   negative_anomalies <dbl>, expected_value <dbl>

Creating Shiny modules
======================

The models are also put into Shiny modules that can be used against a
end user's own data.

In that case, you also need to provide the Shiny output and render
functions for the model.

An example reusing the decomposition example above is shown

    library(googleAnalyticsR) # assume auto-authentication
    library(googleAnalyticsModelR)

    get_model_data <- function(viewId, 
                               date_range = c(Sys.Date()- 300, Sys.Date()), 
                               ...){
      google_analytics(viewId, 
                       date_range = date_range, 
                       metrics = "sessions", 
                       dimensions = "date", 
                       max = -1)
     }

    decompose_sessions <- function(df, ...){
      web_data_ts <- ts(df$sessions, frequency = 7)
      d <- decompose(web_data_ts)
      list(decom = d, plot = plot(d))
    }
     
    # to use in Shiny, supply the output and render functions
    myRenderPlot <- function(x){
      # base plot needs to plot here, not in model_f as can't pass plot objects
      shiny::renderPlot(plot(x$decom))
    }
     
    decomp_ga <- ga_model_make(get_model_data,
                               required_columns = c("date", "sessions"),
                               model_f = decompose_sessions,
                               description = "Performs decomposition on session data and creates a plot",
                               outputShiny = shiny::plotOutput,
                               renderShiny = myRenderPlot)

    # save the model for use later
    ga_model_save(decomp_ga, filename = "decomp_ga.gamr")

The Shiny modules are saved in `decomp_model$shiny_module` and contain
the UI and server side elements for Shiny as explained at
<https://shiny.rstudio.com/articles/modules.html>

To use the modules you set them in your ui and server side functions.

In this case the decomposition model is available in `decomp_model`

    # load up the model at runtime
    decomp_model <- ga_model_load("decomp_ga.gamr")

    # within your ui
      ...
      decomp_model$shiny_module$ui("demo1")
      ...

    # within your server - view_id comes from googleAnalyticsR::authDropdown
      ...
      callModule(decomp_model$shiny_module$server, "demo1", view_id = view_id)
      ...

This can then be used in a Shiny app that hooks into `googleAnalyticsR`
multi-user login features:

    library(shiny)
    library(googleAuthR)
    library(googleAnalyticsR)
    library(googleAnalyticsModelR)

    # set your own Google Cloud Project credentials
    googleAuthR::gar_set_client(scopes = "https://www.googleapis.com/auth/analytics.readonly")

    decomp_model <- ga_model_load("decomp_ga.gamr")

    ## ui.R
    ui <- fluidPage(title = "googleAnalyticsR Model Shiny Demo",
                    authDropdownUI("picker"),
                    h1("Decomp Model"),
                    decomp_model$shiny_module$ui("demo1")
    )

    ## server.R
    server <- function(input, output, session){

      # create a non-reactive access_token as we should never get past this if not authenticated
      gar_shiny_auth(session)

      view_id <- callModule(authDropdown, "picker", ga.table = reactive(ga_account_list()))

      callModule(decomp_model$shiny_module$server, "demo1", view_id = view_id)

      output$view_id <- renderText(view_id())

    }

    shinyApp(gar_shiny_ui(ui, login_ui = gar_shiny_login_ui), server)
